echo "--- Running pre-commit checks ---"

# Ensure pnpm is available
export PATH=$(npm bin):$PATH

# Define directories
dirs="client server"

for dir in $dirs; do
  echo "Processing $dir..."
  cd "$dir" || exit 1

  # TypeScript checks
  echo "Running TypeScript checks in $dir..."
  if pnpm type-check > /dev/null 2>&1; then
    echo "✔ TypeScript checks passed in $dir"  # Green tick for success
  else
    echo "✖ TypeScript checks failed in $dir"  # Red cross for failure
    exit 1
  fi

  # Prettier check
  echo "Prettifying code in $dir..."
  if pnpm prettier --check . > /dev/null 2>&1; then
    echo "✔ Prettier checks passed in $dir"  # Green tick for success
  else
    echo "✖ Prettier checks failed in $dir"  # Red cross for failure
    exit 1
  fi

  cd - > /dev/null || exit
done

echo "--- Pre-commit checks completed successfully ---"
